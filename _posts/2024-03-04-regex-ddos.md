---
layout: post
title: "Regex DDOS"
author: "Kwabena Boadu"
categories: journal
tags: [dns,ssrf,rebind attack]
---

[Regular expression denial of service](https://owasp.org/www-community/attacks/Regular_expression_Denial_of_Service_-_ReDoS), aka Regex DDoS, is an attack that exploits vulnerabilities in the compilation and execution of regular expressions to overwhelm an application/service leading to denial of service for legitimate users.

## How does it occur?

A given regular expression, say `^(a+)+$`, is compiled into a finite state machine (FSM). 
The FSM generated by the compilation may be deterministic or non-deterministic, depending on the language implementation. 
Determinisitic finite automata (DFA) is more desirable than non-deterministic finite automata (NFA) because it contains a finite number of states and thus is more memory efficient.
During compilation, each byte of the expression is inspected and validated ensuring validity of the entire expression.

If the compiled expression generates a large binary, it can exhaust system memory. Some languages libraries, such as Rust, [limit the memory](https://github.com/rust-lang/regex/blob/d7f9347f2a8a7f4e7583c88876411da12a09b572/src/builders.rs#L53) that can be consumed by the compilation.

Validating input against the regular expression involves transitions across the nodes of the FSM; the more complex the expression and input, the more states and transitions there are. 
For example, given the expression: `^(a+)+$`
There are **16** possible states when matching against the input `aaaaX` and **65536** states when matching against the input `aaaaaaaaaaaaaaaaX`.

Extensive use of regex can thus be very resource intensive on your application.
Expressions that involve grouping, greedy matching, backtracking and lookaheads or lookbehinds may be susceptible to Regex DDoS.

## DFAs/NFAs

A highly recommend you checkout a series of articles by [Russ Cox](https://swtch.com/~rsc/regexp/) particularly the write up on [regex comparison](https://swtch.com/~rsc/regexp/regexp1.html); Russ provides a great overview of DFAs and NFAs.

## Parting thoughts

- Use simple expressions when you can. [a-zA-Z]+ might be better performing than [\w]+ because the former is restricted to ASCII only characters
- Consider using more efficient Regex library implementations. Google's [re2](https://github.com/google/re2/wiki/Syntax) library outputs DFAs and is one of the most performant implementations out there. Note that the Rust library is similar to Google's Re2.

